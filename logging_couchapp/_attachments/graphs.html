<!DOCTYPE html>
<html>
  <head>
    <title>CouchApp Logging</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
    <script src="/_utils/script/json2.js"></script>
    <script src="/_utils/script/jquery.js?1.3.1"></script>
    <script src="/_utils/script/jquery.couch.js?0.9.0"></script>
    <script src="vendor/couchapp/jquery.couchapp.js"></script>
    <script src="script/logging.js"></script>
    <script src="script/grapher.js"></script>
    <script type="text/javascript" charset="utf-8">
      $.CouchApp(function(app) {
        var L = new Logging(app);
        var grapher = new Grapher(app);

        var app_id = searchParams().app_id;

        function display(json) {
          var data = grapher.homogenize(json);
          for (ii in data) {
            var t = data[ii];
            $('#content').append(
                '<p>' + t.timestamp
                + ',  ' + t.levels.join(' : ')
                + '</p>'
            );
          }
        };

        app.design.view('hourly', {
          group: true,
          success: function(json) {
            var ary = [];
            for (ii in json.rows) {
              if (app_id === json.rows[ii].key[1]) { ary.push(json.rows[ii]); }
            }
            json.rows = ary;
            display(json);
          }
        });
      });
    </script>
  </head>
  <body>
    <div id="content">
      <h1>CouchLog Graphs</h1>
      <table id="hourly">
        <thead>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </body>
</html>
