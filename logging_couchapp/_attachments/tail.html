<!DOCTYPE html>
<html>
  <head>
    <title>CouchApp Logging</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
    <script src="/_utils/script/json2.js"></script>
    <script src="/_utils/script/jquery.js?1.3.1"></script>
    <script src="/_utils/script/jquery.couch.js?0.9.0"></script>
    <script src="vendor/couchapp/jquery.couchapp.js"></script>
    <script src="script/logging.js"></script>
    <script src="script/log_event_poller.js"></script>
    <script src="script/tail_table.js"></script>
    <script type="text/javascript" charset="utf-8">
      $.CouchApp(function(app) {
        var L = new Logging(app);
        var table = new TailTable(app, { table: '#tail' });

        var poller = new LogEventPoller(app, {
          interval: 5000,
          success: function( json ) { table.addEvents(json); }
        });

        $('button.play').click(function() {
          if (poller.running) {
            poller.stop();
            $(this).text('Play');
          } else {
            poller.start();
            $(this).text('Pause');
          }
        });

        poller.start();

        setInterval(function() {
          $('td[data-timestamp]').each(function() {
            var e = $(this);
            e.text(app.prettyDate(e.attr('data-timestamp')));
          })
        }, 5000);

      });
    </script>
  </head>
  <body>
    <div id="content">
      <h1>CouchLog Tail</h1>
      <table id="tail">
        <thead>
          <tr>
            <th>Time</th>
            <th>Application</th>
            <th>Logger</th>
            <th>Level</th>
            <th>Message</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td colspan="4">Latest: </td>
            <td style="text-align:right"><button class="play">Pause</button></td>
          </tr>
        </tfoot>
        <tbody>
        </tbody>
      </table>
    </div>
    <div id="sidebar">
      <ul id="filter">
        <li id="application" class="">
          <span>Application</span>
          <ul></ul>
        </li>
        <li id="level" class="">
          <span>Level</span>
          <ul></ul>
        </li>
      </ul>
    </div>
  </body>
</html>
